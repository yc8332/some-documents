### 1、information_schema 库中有3张表与锁相关   
`innodb_trx` 记录当前所有的事务   
`innodb_locks` 当前出现的锁   
`innodb_lock_waits` 锁等待的相互关系   

### 2、表结构   
`desc innodb_trx;`   

| Field                      | comment                     |
| :------------------------- | :-------------------------- |
| trx_id                     | 事务id                      |
| trx_state                  | 事务状态                    |
| trx_started                | 事务开始时间                |
| trx_requested_lock_id      | innodb_locks 锁id           |
| trx_wait_started           | 事务开始等待时间            |
| trx_weight                 |                             |
| trx_mysql_thread_id        | 事务线程id                  |
| trx_query                  | 事务具体sql语句             |
| trx_operation_state        | 事务当前操作状态            |
| trx_tables_in_use          | 事务中有多少个表被使用      |
| trx_tables_locked          |                             |
| trx_lock_structs           |                             |
| trx_lock_memory_bytes      | 事务锁住内存大小(B)         |
| trx_rows_locked            | 事务锁住的行数              |
| trx_rows_modified          | 事务更改的行数              |
| trx_concurrency_tickets    | 事务并发票数                |
| trx_isolation_level        | 当前事务隔离级别            |
| trx_unique_checks          | 是否唯一性检查              |
| trx_foreign_key_checks     | 是否外键检查                |
| trx_last_foreign_key_error | 最后一次外键错误            |
| trx_adaptive_hash_latched  |                             |
| trx_adaptive_hash_timeout  |                             |
| trx_is_read_only           | 事务是否只读                |
| trx_autocommit_non_locking | 事务是否自动提交            |

`desc innodb_locks;`   

| Field                      | comment                     |
| :------------------------- | :-------------------------- |
| lock_id                    | 锁id                        |
| lock_trx_id                | 事务id                      |
| lock_mode                  | 锁模式                      |
| lock_type                  | 锁类型                      |
| lock_table                 | 被锁的表                    |
| lock_index                 | 被锁的索引                  |
| lock_space                 |                             |
| lock_page                  |                             |
| lock_rec                   | 被锁的记录                  |
| lock_data                  | 被锁的数据                  |

`desc innodb_lock_waits;`   

| Field                      | comment                     |
| :------------------------- | :-------------------------- |
| requesting_trx_id          | 请求锁的事务id              |
| requested_lock_id          | 请求锁的锁id                |
| blocking_trx_id            | 当前拥有锁的事务id          |
| blocking_lock_id           | 当前拥有锁的锁id            |

### 3、示例   
当事务A给id=6的行加上X锁后，事务B想要更新id=6的行时会被阻塞，300秒后后事务B超时回滚事务。   

| A事务 | B事务 |
| :------------------------------------------------------------------------- | :--------------------------------------------------- |
| begin;                                                                     |                                                      |
| select * from users where id = 6 for update; -> `haah`<br>给id=6的行加上X锁|                                                      |
|                                                                            | set session innodb_lock_wait_timeout = 300;          |
|                                                                            | begin;                                               |
|                                                                            | update users set nickname = 'zhangsan' where id = 6; |
